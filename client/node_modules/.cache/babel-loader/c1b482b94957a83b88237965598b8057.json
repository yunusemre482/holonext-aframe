{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/yunusemre/Desktop/Holonext/holonext-aframe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _createClass = require(\"/Users/yunusemre/Desktop/Holonext/holonext-aframe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar _classCallCheck = require(\"/Users/yunusemre/Desktop/Holonext/holonext-aframe/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createSpeechlySpeechRecognition = void 0;\nvar browser_client_1 = require(\"@speechly/browser-client\");\nvar types_1 = require(\"./types\");\n/**\n * Returns a SpeechRecognition implementation that uses a given Speechly app ID\n * to generate transcriptions using the Speechly API\n *\n * @param appId - Speechly app ID\n * @returns Class that implements the SpeechRecognition interface\n * @public\n */\nvar createSpeechlySpeechRecognition = function createSpeechlySpeechRecognition(appId) {\n  var _a;\n  var _b;\n  var browserSupportsAudioApis = typeof window !== 'undefined' && ((_a = window.navigator) === null || _a === void 0 ? void 0 : _a.mediaDevices) !== undefined && (window.AudioContext !== undefined || window.webkitAudioContext !== undefined);\n  return _b = /*#__PURE__*/_createClass(function SpeechlySpeechRecognition() {\n    var _this = this;\n    _classCallCheck(this, SpeechlySpeechRecognition);\n    this.aborted = false;\n    this.transcribing = false;\n    this.taskQueue = null;\n    this.continuous = false;\n    this.interimResults = false;\n    this.onresult = function () {};\n    this.onend = function () {};\n    this.onerror = function () {};\n    this.start = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              this.aborted = false;\n              _context.next = 4;\n              return this._start();\n            case 4:\n              _context.next = 9;\n              break;\n            case 6:\n              _context.prev = 6;\n              _context.t0 = _context[\"catch\"](0);\n              if (_context.t0 === browser_client_1.ErrNoAudioConsent) {\n                this.onerror(types_1.MicrophoneNotAllowedError);\n              } else {\n                this.onerror(types_1.SpeechRecognitionFailedError);\n              }\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 6]]);\n      }));\n    };\n    this.stop = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return this._stop();\n            case 2:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n    };\n    this.abort = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              this.aborted = true;\n              _context3.next = 3;\n              return this._stop();\n            case 3:\n            case \"end\":\n              return _context3.stop();\n          }\n        }, _callee3, this);\n      }));\n    };\n    this._start = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var _this2 = this;\n        var startTask;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              if (!this.transcribing) {\n                _context5.next = 2;\n                break;\n              }\n              return _context5.abrupt(\"return\");\n            case 2:\n              this.transcribing = true;\n              startTask = function startTask() {\n                return __awaiter(_this2, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n                  var mediaStream;\n                  return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n                    while (1) switch (_context4.prev = _context4.next) {\n                      case 0:\n                        _context4.next = 2;\n                        return this.microphone.initialize();\n                      case 2:\n                        mediaStream = this.microphone.mediaStream;\n                        if (!(mediaStream === null || mediaStream === undefined)) {\n                          _context4.next = 5;\n                          break;\n                        }\n                        throw browser_client_1.ErrDeviceNotSupported;\n                      case 5:\n                        _context4.next = 7;\n                        return this.client.attach(mediaStream);\n                      case 7:\n                        _context4.next = 9;\n                        return this.client.start();\n                      case 9:\n                      case \"end\":\n                        return _context4.stop();\n                    }\n                  }, _callee4, this);\n                }));\n              };\n              _context5.next = 6;\n              return this.enqueueTask(startTask);\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, this);\n      }));\n    };\n    this._stop = function () {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var _this3 = this;\n        var stopTask;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              if (this.transcribing) {\n                _context7.next = 2;\n                break;\n              }\n              return _context7.abrupt(\"return\");\n            case 2:\n              this.transcribing = false;\n              stopTask = function stopTask() {\n                return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n                  return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n                    while (1) switch (_context6.prev = _context6.next) {\n                      case 0:\n                        _context6.prev = 0;\n                        _context6.next = 3;\n                        return this.client.stop();\n                      case 3:\n                        _context6.next = 5;\n                        return this.client.detach();\n                      case 5:\n                        _context6.next = 7;\n                        return this.microphone.close();\n                      case 7:\n                        this.onend();\n                        _context6.next = 12;\n                        break;\n                      case 10:\n                        _context6.prev = 10;\n                        _context6.t0 = _context6[\"catch\"](0);\n                      case 12:\n                      case \"end\":\n                        return _context6.stop();\n                    }\n                  }, _callee6, this, [[0, 10]]);\n                }));\n              };\n              _context7.next = 6;\n              return this.enqueueTask(stopTask);\n            case 6:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, this);\n      }));\n    };\n    this.enqueueTask = function (task) {\n      return __awaiter(_this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n        var _this4 = this;\n        var queuedTask;\n        return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              queuedTask = function queuedTask() {\n                return __awaiter(_this4, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n                  return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n                    while (1) switch (_context8.prev = _context8.next) {\n                      case 0:\n                        _context8.next = 2;\n                        return this.taskQueue;\n                      case 2:\n                        _context8.next = 4;\n                        return task();\n                      case 4:\n                      case \"end\":\n                        return _context8.stop();\n                    }\n                  }, _callee8, this);\n                }));\n              };\n              this.taskQueue = queuedTask();\n              _context9.next = 4;\n              return this.taskQueue;\n            case 4:\n            case \"end\":\n              return _context9.stop();\n          }\n        }, _callee9, this);\n      }));\n    };\n    this.handleResult = function (segment) {\n      if (_this.aborted) {\n        return;\n      }\n      if (!_this.interimResults && !segment.isFinal) {\n        return;\n      }\n      var transcript = segment.words.map(function (x) {\n        return x.value;\n      }).filter(function (x) {\n        return x;\n      }).join(' ');\n      var results = [{\n        0: {\n          transcript: transcript,\n          confidence: 1\n        },\n        isFinal: segment.isFinal\n      }];\n      _this.onresult({\n        results: results,\n        resultIndex: 0\n      });\n      if (!_this.continuous && segment.isFinal) {\n        _this.abort().catch(function () {}); // swallow errors\n      }\n    };\n\n    this.client = new browser_client_1.BrowserClient({\n      appId: appId\n    });\n    this.microphone = new browser_client_1.BrowserMicrophone();\n    this.client.onSegmentChange(this.handleResult);\n  }), _b.hasBrowserSupport = browserSupportsAudioApis, _b;\n};\nexports.createSpeechlySpeechRecognition = createSpeechlySpeechRecognition;\nexports.default = exports.createSpeechlySpeechRecognition;","map":{"version":3,"sources":["../src/createSpeechRecognition.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createSpeechlySpeechRecognition = void 0;\nconst browser_client_1 = require(\"@speechly/browser-client\");\nconst types_1 = require(\"./types\");\n/**\n * Returns a SpeechRecognition implementation that uses a given Speechly app ID\n * to generate transcriptions using the Speechly API\n *\n * @param appId - Speechly app ID\n * @returns Class that implements the SpeechRecognition interface\n * @public\n */\nconst createSpeechlySpeechRecognition = (appId) => {\n    var _a;\n    var _b;\n    const browserSupportsAudioApis = typeof window !== 'undefined' &&\n        ((_a = window.navigator) === null || _a === void 0 ? void 0 : _a.mediaDevices) !== undefined &&\n        (window.AudioContext !== undefined || window.webkitAudioContext !== undefined);\n    return _b = class SpeechlySpeechRecognition {\n            constructor() {\n                this.aborted = false;\n                this.transcribing = false;\n                this.taskQueue = null;\n                this.continuous = false;\n                this.interimResults = false;\n                this.onresult = () => { };\n                this.onend = () => { };\n                this.onerror = () => { };\n                this.start = () => __awaiter(this, void 0, void 0, function* () {\n                    try {\n                        this.aborted = false;\n                        yield this._start();\n                    }\n                    catch (e) {\n                        if (e === browser_client_1.ErrNoAudioConsent) {\n                            this.onerror(types_1.MicrophoneNotAllowedError);\n                        }\n                        else {\n                            this.onerror(types_1.SpeechRecognitionFailedError);\n                        }\n                    }\n                });\n                this.stop = () => __awaiter(this, void 0, void 0, function* () {\n                    yield this._stop();\n                });\n                this.abort = () => __awaiter(this, void 0, void 0, function* () {\n                    this.aborted = true;\n                    yield this._stop();\n                });\n                this._start = () => __awaiter(this, void 0, void 0, function* () {\n                    if (this.transcribing) {\n                        return;\n                    }\n                    this.transcribing = true;\n                    const startTask = () => __awaiter(this, void 0, void 0, function* () {\n                        yield this.microphone.initialize();\n                        const { mediaStream } = this.microphone;\n                        if (mediaStream === null || mediaStream === undefined) {\n                            throw browser_client_1.ErrDeviceNotSupported;\n                        }\n                        yield this.client.attach(mediaStream);\n                        yield this.client.start();\n                    });\n                    yield this.enqueueTask(startTask);\n                });\n                this._stop = () => __awaiter(this, void 0, void 0, function* () {\n                    if (!this.transcribing) {\n                        return;\n                    }\n                    this.transcribing = false;\n                    const stopTask = () => __awaiter(this, void 0, void 0, function* () {\n                        try {\n                            yield this.client.stop();\n                            yield this.client.detach();\n                            yield this.microphone.close();\n                            this.onend();\n                        }\n                        catch (e) {\n                            // swallow errors\n                        }\n                    });\n                    yield this.enqueueTask(stopTask);\n                });\n                this.enqueueTask = (task) => __awaiter(this, void 0, void 0, function* () {\n                    const queuedTask = () => __awaiter(this, void 0, void 0, function* () {\n                        // Wait for earlier task(s) to complete, effectively adding to a task queue\n                        yield this.taskQueue;\n                        yield task();\n                    });\n                    this.taskQueue = queuedTask();\n                    yield this.taskQueue;\n                });\n                this.handleResult = (segment) => {\n                    if (this.aborted) {\n                        return;\n                    }\n                    if (!this.interimResults && !segment.isFinal) {\n                        return;\n                    }\n                    const transcript = segment.words\n                        .map(x => x.value)\n                        .filter(x => x)\n                        .join(' ');\n                    const results = [\n                        {\n                            0: {\n                                transcript,\n                                confidence: 1,\n                            },\n                            isFinal: segment.isFinal,\n                        },\n                    ];\n                    this.onresult({ results, resultIndex: 0 });\n                    if (!this.continuous && segment.isFinal) {\n                        this.abort().catch(() => { }); // swallow errors\n                    }\n                };\n                this.client = new browser_client_1.BrowserClient({ appId });\n                this.microphone = new browser_client_1.BrowserMicrophone();\n                this.client.onSegmentChange(this.handleResult);\n            }\n        },\n        _b.hasBrowserSupport = browserSupportsAudioApis,\n        _b;\n};\nexports.createSpeechlySpeechRecognition = createSpeechlySpeechRecognition;\nexports.default = exports.createSpeechlySpeechRecognition;\n//# sourceMappingURL=createSpeechRecognition.js.map"]},"metadata":{},"sourceType":"script"}